/*! Float.js 0.0.3 2014-05-13 */
function SingleBar(a){this.color=a.color,this._container=a.container,this._parent=a.parent,this.data=a.data,this.height=a.height,this.width=a.width}function GroupBar(a){this.height=a.height,this.width=a.width,this._container=a.container,this._parent=a.parent,this.data=a.data,this.colorList=a.colorList,this._seriesName=a.seriesName,this.type=a.type||1}function Legend(a){this._parent=a.parent,this._container=a.container,this._seriesName=a.seriesName,this._colorList=a.colorList,this.xSpace=a.xSpace,this._isShow=!0}function XAxis(a){this._parent=a.parent,this.xSpace=a.xSpace||0,this.ySpace=a.ySpace||0,this._container=a.container}function YAxis(a){this._parent=a.parent,this._container=a.container,this.xSpace=a.xSpace||0,this.ySpace=a.ySpace||0}function Graph(a){this.node=a.element||"body",this.series=a.series,this.width=a.width,this.height=a.height,this.type=a.type||"column",this.chartObject=[],this.hasXAxis=a.xAxis||!1,this.hasYAxis=a.yAxis||!1,this.hasLegend=a.legend||!1,this.hasStack=a.stack||!1,this.leftGap=this.width*xSpaceRate,this.bottomGap=this.height*ySpaceRate,this.rightGap=this.width*xSpaceRate/2,this.topGap=this.height*ySpaceRate/2,this.xScale=null,this.yScale=null,this.cfg=a}var Frost={namespace:function(a){var b=[],c=Frost;if(a.indexOf(".")>=0){b=a.split(".");for(var d=1;d!=b.length;d++)c[b[d]]=c[b[d]]||{},c=c[b[d]]}return Frost},clone:function(a){var b={},c=this;if(c.isString(a)||c.isNumber(a)||c.isBoolean(a))return a;for(var d in a)if(Array.isArray(a[d])){b[d]=[];for(var e=0;e!=a[d].length;e++)b[d].push(c.clone(a[d][e]))}else b[d]="object"!=typeof a[d]?a[d]:c.clone(a[d]);return b},extend:function(a,b){var c=a.prototype;a.superclass=b.prototype;var d=function(){};d.prototype=b.prototype,a.prototype=new d;for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e]);return a.prototype.constructor=a,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b),a},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isArray:function(a){return Array.isArray(a)}};Frost.namespace("Frost.ColorConst"),Frost.ColorConst=function(a){var b=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"];if(a>=b.length)return b;for(var c=[],d=0;d!=a;d++){var e=Math.floor(Math.random()*b.length);c.push(b.splice(e,1)[0])}return c},Frost.namespace("Frost.SingleBar"),SingleBar.prototype.getHeight=function(){return this.height},SingleBar.prototype.setHeight=function(a){this.height=a},SingleBar.prototype.getWidth=function(){return this.width},SingleBar.prototype.setWidth=function(a){this.Width=a},SingleBar.prototype.getContainer=function(){return this._container},SingleBar.prototype.setContainer=function(a){this._container=a},SingleBar.prototype.getParent=function(){return this._parent},SingleBar.prototype.getColor=function(){return this.color},SingleBar.prototype.getData=function(){return this.data},SingleBar.prototype.getGroupContainer=function(){return this._groupContainer},SingleBar.prototype.render=function(){var a=this.getParent().getXScale(),b=this.getParent().getYScale(),c=this.getHeight();this._groupContainer=this._container.append("g"),this._groupContainer.selectAll(".frost_bar").data(this.getData()).enter().append("rect").attr("class","frost_bar").attr("x",function(b){return a(b.name)}).attr("y",function(a){return b(a.value)}).attr("height",function(a){return c-b(a.value)}).attr("width",a.rangeBand()).attr("fill",this.getColor())},Frost.SingleBar=SingleBar,Frost.namespace("Frost.GroupBar"),GroupBar.prototype.getType=function(){return this.type},GroupBar.prototype.getHeight=function(){return this.height},GroupBar.prototype.setHeight=function(a){this.height=a},GroupBar.prototype.getWidth=function(){return this.width},GroupBar.prototype.setWidth=function(a){this.Width=a},GroupBar.prototype.getContainer=function(){return this._container},GroupBar.prototype.setContainer=function(a){this._container=a},GroupBar.prototype.getParent=function(){return this._parent},GroupBar.prototype.getData=function(){return this.data},GroupBar.prototype.getColorList=function(){return this.colorList},GroupBar.prototype.getSeriesName=function(){return this._seriesName},GroupBar.prototype.render=function(){var a=this.getParent().getXScale(),b=this.getParent().getYScale(),c=d3.scale.ordinal(),d=this.getHeight(),e=this.getColorList(),f=Frost.Util.formatDataForGroupBar(this.getData());this._groupContainer=this._container.append("g"),c.domain(this.getSeriesName()).rangeRoundBands([0,a.rangeBand()]),1==this.getType()&&(a.domain(this.getSeriesName()),f=this.getData(),this.getParent().setLegendName(this.getParent().getNameDomain()),c.domain(this.getParent().getNameDomain()).rangeRoundBands([0,a.rangeBand()]));var g=this._groupContainer.selectAll(".frost_groupBar").data(f).enter().append("g").attr("class","frost_groupBar_single").attr("transform",function(b){return"translate("+a(b.name)+",0)"});return g.selectAll("rect").data(function(a){return a.data}).enter().append("rect").attr("width",c.rangeBand()).attr("x",function(a){return c(a.name)}).attr("y",function(a){return b(a.value)}).attr("height",function(a){return d-b(a.value)}).style("fill",function(a,b){return e[b]}),this},Frost.GroupBar=GroupBar,Frost.namespace("Frost.Legend"),Legend.prototype.getParent=function(){return this._parent},Legend.prototype.getContainer=function(){return this._container},Legend.prototype.getSeriesName=function(){return this._seriesName},Legend.prototype.getColorList=function(){return this._colorList},Legend.prototype.getXSpace=function(){return this.xSpace},Legend.prototype.show=function(){this._isShow=!0,this._containerSVGNode.style("display","block")},Legend.prototype.hide=function(){this._isShow=!1,this._containerSVGNode.style("display","none")},Legend.prototype.render=function(){var a=d3.scale.ordinal().range(this.getColorList());this._containerSVGNode=this._container.append("svg");var b=this._containerSVGNode.append("g").attr("class","frost_legend");this._legend=b.selectAll(".frost_legend_single").data(this.getSeriesName()).enter().append("g").attr("class","frost_legend_single").attr("transform",function(a,b){return"translate(0,"+20*b+")"}),this._legend.append("rect").attr("x",82).attr("width",18).attr("height",18).style("fill",a),this._legend.append("text").attr("x",76).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a});var c=document.querySelector(".frost_legend").getBoundingClientRect();return this._containerSVGNode.attr("width",100).attr("height",c.height),this._container.style("top","20px").style("left",this.getXSpace()-100+"px").style("width","100px").style("height",c.height+"px"),this._bindUI(),this},Legend.prototype._bindUI=function(){this._container.on("click",function(){this._isShow?this.hide():this.show()}.bind(this))},Frost.Legend=Legend,Frost.namespace("Frost.XAxis"),XAxis.prototype.getySpace=function(){return this.ySpace},XAxis.prototype.getxSpace=function(){return this.xSpace},XAxis.prototype.getParent=function(){return this._parent},XAxis.prototype.getContainer=function(){return this._container},XAxis.prototype.render=function(){this.xAxisNode=this._container.append("g").attr("class","frost_axis frost_xAxis").attr("transform","translate("+this.getxSpace()+","+this.getySpace()+")");var a=d3.svg.axis().scale(this.getParent().getXScale()).tickSize(1).tickPadding(4).orient("bottom");return this.xAxisNode.call(a),this},Frost.XAxis=XAxis,Frost.namespace("Frost.Util");var Util={};Util.getNameDomain=function(a){for(var b=[],c=0;c!=a.length;c++)for(var d=a[c].data,e=0;e!=d.length;e++)b.indexOf(d[e].name)<0&&b.push(d[e].name);return b},Util.getMaxValue=function(a){for(var b=d3.max(a[0].data,function(a){return Number(a.value)}),c=0;c!=a.length;c++){var d=d3.max(a[c].data,function(a){return Number(a.value)});d>=b&&(b=d)}return b},Util.getSeriesName=function(a){for(var b=[],c=0;c!=a.length;c++)b.push(a[c].name);return b},Util.getColorList=function(a){if(a[0].color){for(var b=[],c=0;c!=a.length;c++)b.push(a[c].color);return b}return Frost.ColorConst(a.length)},Util.formatDataForGroupBar=function(a){for(var b=function(a,b){for(var c=0,d=0;d!=b.length;d++)if(b[d].name==a)return c=b[d].value;return c},c=[],d=this.getNameDomain(a),e=0;e!=d.length;e++){var f={};f.name=d[e],f.data=[];for(var g=0;g!=a.length;g++){var h={};h.name=a[g].name,h.value=b(f.name,a[g].data),f.data.push(h)}c.push(f)}return c},Util.formatDataForStackBar=function(){},Frost.Util=Util,Frost.namespace("Frost.YAxis"),YAxis.prototype.getParent=function(){return this._parent},YAxis.prototype.getContainer=function(){return this._container},YAxis.prototype.getySpace=function(){return this.ySpace},YAxis.prototype.getxSpace=function(){return this.xSpace},YAxis.prototype.render=function(){this.yAxisNode=this._container.append("g").attr("class","frost_axis frost_yAxis").attr("transform","translate("+this.getxSpace()+", "+this.getySpace()+")");var a=d3.svg.axis().scale(this.getParent().getYScale()).tickSize(1).tickPadding(4).orient("left");return this.yAxisNode.call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(""),this},Frost.YAxis=YAxis,Frost.namespace("Frost.Graph");var ySpaceRate=20/300,xSpaceRate=.04;Graph.prototype.getCfg=function(){return this.cfg},Graph.prototype.getNode=function(){return this.node},Graph.prototype.setNode=function(a){this.node=a},Graph.prototype.getType=function(){return this.type},Graph.prototype.getSeries=function(){return this.series},Graph.prototype.setSeries=function(a){this.series=a},Graph.prototype.getWidth=function(){return this.width},Graph.prototype.setWidth=function(a){this.width=a},Graph.prototype.getHeight=function(){return this.height},Graph.prototype.setHeight=function(a){this.height=a},Graph.prototype.getChartObject=function(){return this.chartObject},Graph.prototype.setChartObject=function(a){this.chartObject=a},Graph.prototype.getXScale=function(){return this.xScale},Graph.prototype.getYScale=function(){return this.yScale},Graph.prototype.getContainer=function(){return this._container},Graph.prototype.IsHasYAxis=function(){return this.hasYAxis},Graph.prototype.IsHasXAxis=function(){return this.hasXAxis},Graph.prototype.IsHasLegend=function(){return this.hasLegend},Graph.prototype.IsStack=function(){return this.hasStack},Graph.prototype.getLeftGap=function(){return this.leftGap},Graph.prototype.getBottomGap=function(){return this.bottomGap},Graph.prototype.getTopGap=function(){return this.topGap},Graph.prototype.getRightGap=function(){return this.rightGap},Graph.prototype.getXAxis=function(){return this.xAxis},Graph.prototype.getYAxis=function(){return this.yAxis},Graph.prototype.getLegend=function(){return this.legend},Graph.prototype.setNameDomain=function(a){this.nameDomain=a},Graph.prototype.getNameDomain=function(){return this.nameDomain},Graph.prototype.setYScaleMaxValue=function(a){this.yScaleMaxValue=a},Graph.prototype.setLegendName=function(a){this.legendName=a},Graph.prototype.render=function(){var a=d3.select(this.node).append("div").attr("class","frost_rootNode").style("height",this.getHeight()+"px").style("width",this.getWidth()+"px"),b=a.append("div").attr("class","frost_legendRootNode"),c=a.append("svg").attr("width",this.getWidth()).attr("height",this.getHeight());this._container=c.append("g").attr("transform","translate("+this.getLeftGap()+","+this.getTopGap()+")");var d=Frost.Util.getColorList(this.getSeries()),e=this.IsHasXAxis()?this.getWidth()-this.getLeftGap()-this.getRightGap():this.getWidth(),f=this.IsHasYAxis()?this.getHeight()-this.getBottomGap()-this.getTopGap():this.getHeight(),g=Frost.Util.getSeriesName(this.getSeries());switch(this.legendName=g,this.xScale=d3.scale.ordinal().rangeRoundBands([0,e],.1),this.yScale=d3.scale.linear().range([f,0]),this.nameDomain=Frost.Util.getNameDomain(this.getSeries()),this.yScaleMaxValue=Frost.Util.getMaxValue(this.getSeries()),this.xScale.domain(this.nameDomain),this.yScale.domain([0,this.yScaleMaxValue]),this.getType().toLowerCase()){case"bar":1==this.getSeries().length?this.chartObject.push(new Frost.SingleBar({width:e,height:f,data:this.getSeries()[0].data,container:this._container,parent:this,color:d[0]}).render()):this.getSeries().length>1&&(this.IsStack()?console.log(Frost.Util.formatDataForStackBar(this.getSeries())):this.chartObject.push(new Frost.GroupBar({width:e,height:f,data:this.getSeries(),container:this._container,parent:this,seriesName:g,colorList:d,type:this.getCfg().barType}).render()))}return this.IsHasXAxis()&&this.xAxisRender({parent:this,container:this._container,xSpace:0,ySpace:this.getHeight()-this.getBottomGap()-this.topGap}),this.IsHasYAxis()&&this.yAxisRender({parent:this,container:this._container,xSpace:0,ySpace:0}),this.IsHasLegend()&&this.legendRender({parent:this,container:b,seriesName:this.legendName,colorList:d,xSpace:this.getWidth()}),this},Graph.prototype.xAxisRender=function(a){this.xAxis=new Frost.XAxis({parent:a.parent,container:a.container,xSpace:a.xSpace,ySpace:a.ySpace}).render()},Graph.prototype.yAxisRender=function(a){this.yAxis=new Frost.YAxis({parent:a.parent,container:a.container,xSpace:a.xSpace,ySpace:a.ySpace}).render()},Graph.prototype.legendRender=function(a){this.legend=new Frost.Legend({parent:a.parent,container:a.container,seriesName:a.seriesName,colorList:a.colorList,xSpace:a.xSpace}).render()},Frost.Graph=Graph;